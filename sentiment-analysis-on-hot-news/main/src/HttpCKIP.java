
import java.io.BufferedReader;
import java.io.DataOutputStream;
import java.io.IOException;
import java.io.InputStreamReader;
import java.net.HttpURLConnection;
import java.net.MalformedURLException;
import java.net.URL;
import java.net.URLEncoder;
import java.util.ArrayList;
import java.util.Iterator;
import java.util.LinkedList;
import java.util.List;
import java.util.regex.Matcher;
import java.util.regex.Pattern;
import org.dom4j.Document;
import org.dom4j.DocumentException;
import org.dom4j.DocumentHelper;
import org.dom4j.Element;

/**
 * CKIP Client for Java<br/>
 * 
 */
public class HttpCKIP extends WordSegmentationService {
	
	public HttpCKIP() {
		

	}
	public static void main(String args[]) throws IOException,
			DocumentException {

		HttpCKIP HttpCKIP = new HttpCKIP();
		
		Content content=new Content(HttpCKIP.getCKIPByHTTP("、有寫悔過書.賠錢=有悔意應不會再犯！什麼邏輯、干，小雞雞都放到洞裡了還判這麼輕這法官想法到底-_-#、殷勤殷勤殷勤殷勤殷勤、26萬入袋、新聞都爆出來了他女友不知道也難..、果然免錢最貴!、因為他插的不是恐龍法官他老母還是女兒、你是法律和邏輯盲流吧。賠錢就是和解，和解要兩造都同意，賠償金也是兩者同意。這等於是法官把刑期交給被害人去決定，而不是法官一人自己判，其實對被害人是很好的。小朋友，下次多念點書再公開發言好嘛。、ElvisSung如果他插的是恐龍法官他老母還是女兒，法官本人必須迴避本案，但是他一定會透過關係，請同儕法官判他最大刑度，民事刑事都是！、下體尺寸她怎麼測的...?、這不是肯的雞、是因為還有點位子所以發現...、犯後態度的問題，不過判到法定最輕刑度3年還輕是挺令人意外的。、應該是用了刑法59條吧，不過本案實在看不出有什麼特別情形可憫的狀況，如果上訴到最高應該會發回重審。、陳凱劭話說不見得有和解喔...一般受害人會提刑事告訴附帶民事賠償，民事賠償的部分有可能是和解，也有可能是和解不成由法院酌定賠償金額。、法官：如何知道尺寸不同女：因為太小沒感覺該罰！、不能怪法官，最主要是『和解』，意思是被害人收了錢，所以原諒加害人。有錢，還是很好用...、所以才要報出來給其他人知道不要讓他女友知道不要讓他女友知道不要讓他女友知道、想問尺寸不對是怎麼發現的~還是因為尺寸太小的因素~所以才判最輕~、賠償不等於和解喔，也有可能是和解不成由法院酌定侵權行為的賠償金額。況且就算有和解，也不等於法院可以判到法定最輕刑度之下，乘機性交罪是三年以上，十年以下，一般慣例來說就算雙方當事人達成民事和解，刑事的部分也只會判最低刑度(本案是三年)，判到只有兩年是挺怪的。、林廉昂內文已經說明法官參酌對方已當庭賠償26萬是在審判中給的所以法官才會參酌在因此下判決所以非附帶民事賠償民事賠償要法官下刑度時一起諭知例如判3年,賠償對方30萬陳凱劭講得沒錯喔、應該是低頭含棒了發覺太小又有腥味於是感到不滿足就賺到了26萬、護家盟跟妄想要選立委的基督教信心希望聯盟怎麼不比照妖魔化同性戀的模式,順便用異性戀行為導致道德淪喪,應停止異性戀婚姻權?、用深度測長度囉！、寬度也是個依據、26萬可以去酒店找更正的玩一個月了！、這不是肯德雞~這不是肯德雞、刑事應該不會判加害人賠償給被害人，必須另案民事求償。我沒去細查此案，以這樣的判決，應該是有達成和解。不過判處低於最低刑度，確實有點奇怪。、林奎伯可是彌補不了一輩子的創傷、進去的時候，尺寸女生都會有感覺啊~~~、尺寸不同....果然酒醉還是有意識的....、免錢的最貴，沒坐牢算他好運，26w算教訓便宜他了。、IvanChang誰說的?你又知道她一定放不下了?、一種塞好塞滿與還有位置的概念、IvanChang她如果是台灣第一位不勝酒力被性侵的我就相信、這不是肯得基。、因為不是帥哥?、26萬可以找援交玩到腿軟都玩不玩了！又沒真正舒服到！何必衝動！、牙籤與香蕉你是感覺不出來嗎、一堆人說標題沒水準有水準怎麼吸引你的目光、我只看到~吳男同齡的女大生~19歲............無言阿!~、「應」無再犯之虞，昨「輕」判他2年.緩刑5年。這是台灣的法律~、去ktv喝到爛醉~然後讓男生人去廁所幫你換衣服....依種種情節說不是仙人跳我很難再解釋會有女生自墮到這種地步!!、size太小不滿意啦最好是脫完衣服就睡著當大家是都沒喝醉過喔…、如果給我26萬台幣,老實說我也給他上hahahaha、保龍一族：前方有可疑樵夫皇上：我是皇上通通給我閃開別擋我的路（大喊）~~~皇上：我們要低調點，別讓人知道我是皇上保龍一族：…………、蘋果沒新聞可以報了嗎？居然還要拿自由時報的新聞來報?、就好比如說……懶x比雞腿？、IvanChang你意思是觸控的嗎？、有是鑽石雞、果然不是熟悉的感覺，手法有在加強、一堆酸男、現在女人敢告都有幾十萬入袋!真好賺、人必自重而後人重之,人必自辱而後人辱之女人不醉.男人?機會、垃圾女生喝醉性親26萬太便宜了讓他進去關一關讓你們的受刑人類帶他、DannyLeung屁屁?哈哈、不夠爽、下面的甲甲準備爆你菊花、女生男友根本沒去唱歌，如果女生醉到誤以為是男友而熱情回吻，那又如何能清醒的分辨出下體尺寸與男友不同?而且與男友手法不同時，不是早就該驚覺有異?疑點重重，我認為做到一半突然後悔的機率很大，但又怕事後男友早晚知道，所以就告對方性侵了，其實前戲全程都沒睜眼，卻都主動配合，已經很不合理。、李偉濠你可以被強姦看看，看你放得下嗎、好傻好天真純潔沒關係走出來就會更好拍拍...咦~賺了26萬....驚喜好暗爽、脫完衣服就睡著，我是相信的，但熱情回吻，又發現跟男友手法不同，還繼續跟對方做愛，而且……全部過程直到做愛才睜眼，這真是睜眼說瞎話。、這只是ㄧ個尺寸不合的問題而已，大家不要太認真、張蘿拉學妹，給人家點面子，大家都知道是他沒看清楚還硬辯，咱們就小聲講就好了。、DannyLeung是桶菊花喔！你確定？、還有，吳男邀請三位好友（好友喔），女生也獲邀請，然後又說是初次見面!、女友驚醒...怎麼會痛....尺寸不同....、林奎伯26萬玩不到一個月吧.26萬大概只能玩40個小時，當然你要平均分攤到一個月也行、哈！、不能同意妳更多、驚覺不是男友尺寸你的尺寸讓她太不爽了一定不是鄉民。、顯然這兩人的尺寸差很多，才能讓人感覺到有不同的差異、他會對羊咩咩有興趣嗎@@?、你替他伸冤了、青春仔肉體、滿街鑽石雞、26萬可以'援助'13次金絲貓，這篇報導男一號吳男笨的跟豬一樣、26萬可以'援助'13次金絲貓，這篇報導男一號吳男笨的跟豬一樣、IvanChang他的意思是說花26萬還被判刑不如事前冷靜花26萬去酒店、張蘿拉恩~刑訴501，沒看到當庭兩字~SORRY~、爽賺26萬～做到一半根本沒完事比酒店還好賺～不會保護自己的女生根本活該吧這要嘛詐騙要嘛男主角太差不然怎麼看都像你情我願、為了26萬就出賣自己的屁股?、免錢的真貴、活該～把持不住就是26萬、豔陽天朋友的朋友ˇˇ、吳男～我也是有15CM長啊....嗚嗚嗚、簡志緯明白，不過她沒要朋友帶她去清洗，意圖可見。、GeorgeHsieh這砲真貴ㄚ、豔陽天不得不同意你、很好奇，她驚覺的尺寸是比較大還是比較小？比較大，偷偷再連絡。比較小……錢拿來，給你祖嬤滾開！、穿錯別人的夾腳拖都立刻知道了,更何況..............、女的不自愛，男的喪道德，怨不得人。。。、爽賺２６萬、標題很靠北呢！、還是那句。免費的最貴!千萬不要心存僥倖!需要的話還是花錢去找最好。"));

		//System.out.println(HttpCKIP.getCKIPByHTTP("、有寫悔過書.賠錢=有悔意應不會再犯！什麼邏輯、干，小雞雞都放到洞裡了還判這麼輕這法官想法到底-_-#、殷勤殷勤殷勤殷勤殷勤、26萬入袋、新聞都爆出來了他女友不知道也難..、果然免錢最貴!、因為他插的不是恐龍法官他老母還是女兒、你是法律和邏輯盲流吧。賠錢就是和解，和解要兩造都同意，賠償金也是兩者同意。這等於是法官把刑期交給被害人去決定，而不是法官一人自己判，其實對被害人是很好的。小朋友，下次多念點書再公開發言好嘛。、ElvisSung如果他插的是恐龍法官他老母還是女兒，法官本人必須迴避本案，但是他一定會透過關係，請同儕法官判他最大刑度，民事刑事都是！、下體尺寸她怎麼測的...?、這不是肯的雞、是因為還有點位子所以發現...、犯後態度的問題，不過判到法定最輕刑度3年還輕是挺令人意外的。、應該是用了刑法59條吧，不過本案實在看不出有什麼特別情形可憫的狀況，如果上訴到最高應該會發回重審。、陳凱劭話說不見得有和解喔...一般受害人會提刑事告訴附帶民事賠償，民事賠償的部分有可能是和解，也有可能是和解不成由法院酌定賠償金額。、法官：如何知道尺寸不同女：因為太小沒感覺該罰！、不能怪法官，最主要是『和解』，意思是被害人收了錢，所以原諒加害人。有錢，還是很好用...、所以才要報出來給其他人知道不要讓他女友知道不要讓他女友知道不要讓他女友知道、想問尺寸不對是怎麼發現的~還是因為尺寸太小的因素~所以才判最輕~、賠償不等於和解喔，也有可能是和解不成由法院酌定侵權行為的賠償金額。況且就算有和解，也不等於法院可以判到法定最輕刑度之下，乘機性交罪是三年以上，十年以下，一般慣例來說就算雙方當事人達成民事和解，刑事的部分也只會判最低刑度(本案是三年)，判到只有兩年是挺怪的。、林廉昂內文已經說明法官參酌對方已當庭賠償26萬是在審判中給的所以法官才會參酌在因此下判決所以非附帶民事賠償民事賠償要法官下刑度時一起諭知例如判3年,賠償對方30萬陳凱劭講得沒錯喔、應該是低頭含棒了發覺太小又有腥味於是感到不滿足就賺到了26萬、護家盟跟妄想要選立委的基督教信心希望聯盟怎麼不比照妖魔化同性戀的模式,順便用異性戀行為導致道德淪喪,應停止異性戀婚姻權?、用深度測長度囉！、寬度也是個依據、26萬可以去酒店找更正的玩一個月了！、這不是肯德雞~這不是肯德雞、刑事應該不會判加害人賠償給被害人，必須另案民事求償。我沒去細查此案，以這樣的判決，應該是有達成和解。不過判處低於最低刑度，確實有點奇怪。、林奎伯可是彌補不了一輩子的創傷、進去的時候，尺寸女生都會有感覺啊~~~、尺寸不同....果然酒醉還是有意識的....、免錢的最貴，沒坐牢算他好運，26w算教訓便宜他了。、IvanChang誰說的?你又知道她一定放不下了?、一種塞好塞滿與還有位置的概念、IvanChang她如果是台灣第一位不勝酒力被性侵的我就相信、這不是肯得基。、因為不是帥哥?、26萬可以找援交玩到腿軟都玩不玩了！又沒真正舒服到！何必衝動！、牙籤與香蕉你是感覺不出來嗎、一堆人說標題沒水準有水準怎麼吸引你的目光、我只看到~吳男同齡的女大生~19歲............無言阿!~、「應」無再犯之虞，昨「輕」判他2年.緩刑5年。這是台灣的法律~、去ktv喝到爛醉~然後讓男生人去廁所幫你換衣服....依種種情節說不是仙人跳我很難再解釋會有女生自墮到這種地步!!、size太小不滿意啦最好是脫完衣服就睡著當大家是都沒喝醉過喔…、如果給我26萬台幣,老實說我也給他上hahahaha、保龍一族：前方有可疑樵夫皇上：我是皇上通通給我閃開別擋我的路（大喊）~~~皇上：我們要低調點，別讓人知道我是皇上保龍一族：…………、蘋果沒新聞可以報了嗎？居然還要拿自由時報的新聞來報?、就好比如說……懶x比雞腿？、IvanChang你意思是觸控的嗎？、有是鑽石雞、果然不是熟悉的感覺，手法有在加強、一堆酸男、現在女人敢告都有幾十萬入袋!真好賺、人必自重而後人重之,人必自辱而後人辱之女人不醉.男人?機會、垃圾女生喝醉性親26萬太便宜了讓他進去關一關讓你們的受刑人類帶他、DannyLeung屁屁?哈哈、不夠爽、下面的甲甲準備爆你菊花、女生男友根本沒去唱歌，如果女生醉到誤以為是男友而熱情回吻，那又如何能清醒的分辨出下體尺寸與男友不同?而且與男友手法不同時，不是早就該驚覺有異?疑點重重，我認為做到一半突然後悔的機率很大，但又怕事後男友早晚知道，所以就告對方性侵了，其實前戲全程都沒睜眼，卻都主動配合，已經很不合理。、李偉濠你可以被強姦看看，看你放得下嗎、好傻好天真純潔沒關係走出來就會更好拍拍...咦~賺了26萬....驚喜好暗爽、脫完衣服就睡著，我是相信的，但熱情回吻，又發現跟男友手法不同，還繼續跟對方做愛，而且……全部過程直到做愛才睜眼，這真是睜眼說瞎話。、這只是ㄧ個尺寸不合的問題而已，大家不要太認真、張蘿拉學妹，給人家點面子，大家都知道是他沒看清楚還硬辯，咱們就小聲講就好了。、DannyLeung是桶菊花喔！你確定？、還有，吳男邀請三位好友（好友喔），女生也獲邀請，然後又說是初次見面!、女友驚醒...怎麼會痛....尺寸不同....、林奎伯26萬玩不到一個月吧.26萬大概只能玩40個小時，當然你要平均分攤到一個月也行、哈！、不能同意妳更多、驚覺不是男友尺寸你的尺寸讓她太不爽了一定不是鄉民。、顯然這兩人的尺寸差很多，才能讓人感覺到有不同的差異、他會對羊咩咩有興趣嗎@@?、你替他伸冤了、青春仔肉體、滿街鑽石雞、26萬可以'援助'13次金絲貓，這篇報導男一號吳男笨的跟豬一樣、26萬可以'援助'13次金絲貓，這篇報導男一號吳男笨的跟豬一樣、IvanChang他的意思是說花26萬還被判刑不如事前冷靜花26萬去酒店、張蘿拉恩~刑訴501，沒看到當庭兩字~SORRY~、爽賺26萬～做到一半根本沒完事比酒店還好賺～不會保護自己的女生根本活該吧這要嘛詐騙要嘛男主角太差不然怎麼看都像你情我願、為了26萬就出賣自己的屁股?、免錢的真貴、活該～把持不住就是26萬、豔陽天朋友的朋友ˇˇ、吳男～我也是有15CM長啊....嗚嗚嗚、簡志緯明白，不過她沒要朋友帶她去清洗，意圖可見。、GeorgeHsieh這砲真貴ㄚ、豔陽天不得不同意你、很好奇，她驚覺的尺寸是比較大還是比較小？比較大，偷偷再連絡。比較小……錢拿來，給你祖嬤滾開！、穿錯別人的夾腳拖都立刻知道了,更何況..............、女的不自愛，男的喪道德，怨不得人。。。、爽賺２６萬、標題很靠北呢！、還是那句。免費的最貴!千萬不要心存僥倖!需要的話還是花錢去找最好。"));
		

	}
	public void send_query() throws DocumentException {
		try {
			URL url = new URL(
					"http://sunlight.iis.sinica.edu.tw/cgi-bin/text.cgi");
			HttpURLConnection httpConn = (HttpURLConnection) url
					.openConnection();
			httpConn.setRequestMethod("POST");
			httpConn.setDoOutput(true);
			httpConn.setUseCaches(false);
			DataOutputStream post = new DataOutputStream(
					httpConn.getOutputStream());
			String postData = "query="
					+ URLEncoder.encode(this.rawText, "Big5");
			post.writeBytes(postData);
			post.flush();
			post.close();
			BufferedReader response = new BufferedReader(new InputStreamReader(
					httpConn.getInputStream(), "Big5"));
			String s, res = "";
			while ((s = response.readLine()) != null) {
				res += s;
			}
			// System.out.println(rest);
			// URL='/uwextract/pool/5302.html'
			String patternStr = "URL=\'/uwextract/pool/(\\d+).html\'";
			Pattern pattern = Pattern.compile(patternStr);
			Matcher matcher = pattern.matcher(res);
			String postfix_url = "";
			if (matcher.find()) {
				postfix_url = matcher.group(1);
				// System.out.println(postfix_url);
				// send_redirect("/uwextract/pool/" + postfix_url + ".html");
				send_pool(postfix_url + ".tag.txt");
			}
			httpConn.disconnect();
		} catch (MalformedURLException e) {
			e.printStackTrace();
		} catch (IOException e) {
			e.printStackTrace();
		}
	}

	public void send_redirect(String posturl) {
		try {
			URL url = new URL("http://sunlight.iis.sinica.edu.tw" + posturl);
			HttpURLConnection httpConn = (HttpURLConnection) url
					.openConnection();
			BufferedReader response = new BufferedReader(new InputStreamReader(
					httpConn.getInputStream(), "UTF-8"));
			String s;
			while ((s = response.readLine()) != null) {
				this.returnText += s;
			}
			// System.out.println(this.returnText);
			String patternStr = "a HREF=(\\d+.tag.txt)";
			Pattern pattern = Pattern.compile(patternStr);
			Matcher matcher = pattern.matcher(this.returnText);
			String postfix_url = "";
			if (matcher.find()) {
				postfix_url = matcher.group(1);
				send_pool(postfix_url);
			}
			httpConn.disconnect();
		} catch (MalformedURLException e) {
			e.printStackTrace();
		} catch (IOException e) {
			e.printStackTrace();
		}
	}

	public void send_pool(String posturl) {
		try {
			URL url = new URL(
					"http://sunlight.iis.sinica.edu.tw/uwextract/pool/"
							+ posturl);
			HttpURLConnection httpConn = (HttpURLConnection) url
					.openConnection();
			BufferedReader response = new BufferedReader(new InputStreamReader(
					httpConn.getInputStream(), "Big5"));
			String ln = "", res = "";
			while ((ln = response.readLine()) != null)
				if (!ln.startsWith("-"))
					res += ln;
			this.setReturnText(res);
			// System.out.println(res);
			httpConn.disconnect();
		} catch (MalformedURLException e) {
			e.printStackTrace();
		} catch (IOException e) {
			e.printStackTrace();
		}
	}

	
	public List<Term> getTerm() {
		try {
			List<Term> tl = new ArrayList<Term>();
			Document d = DocumentHelper.parseText(this.getReturnText());
			Element root = d.getRootElement();
			Element n;

			for (Iterator<?> i = root.elementIterator("Segment"); i.hasNext();) {
				n = (Element) i.next();
				Term t = new Term();
				for (Iterator<?> j = n.elementIterator("token"); j.hasNext();) {
					Element element = (Element) j.next();
					t.setTerm(element.getText());

				}
				for (Iterator<?> j = n.elementIterator("pos"); j.hasNext();) {
					Element element = (Element) j.next();
					t.setTag(element.getText());
				}
				if (!t.getTerm().equals("")) {
					tl.add(t);
				}
			}
			this.term = tl;
		} catch (DocumentException e) {
			e.printStackTrace();
		}

		return this.term;
	}

	public LinkedList<String> getCKIPByHTTP(String content) throws DocumentException {

		HttpCKIP ckip = new HttpCKIP();
		ckip.setRawText(content);
		ckip.send_query();

		return ckip.getReturnList();
	}
	
	
}
